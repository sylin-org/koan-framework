{
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.AspNetCore": "Warning",
      "Koan": "Debug"
    }
  },
  "AllowedHosts": "*",
  "Urls": "http://localhost:27500",

  "IpRateLimiting": {
    "EnableEndpointRateLimiting": true,
    "StackBlockedRequests": false,
    "RealIpHeader": "X-Real-IP",
    "ClientIdHeader": "X-ClientId",
    "HttpStatusCode": 429,
    "GeneralRules": [
      {
        "Endpoint": "POST:/api/search",
        "Period": "1m",
        "Limit": 100
      },
      {
        "Endpoint": "*",
        "Period": "1m",
        "Limit": 1000
      }
    ],
    "ClientWhitelist": [
      "127.0.0.1",
      "::1"
    ]
  },

  "Koan": {
    "Context": {
      "Security": {
        "EnableRestrictivePathValidation": false,
        "AllowedDirectories": [
          // Only enforced when EnableRestrictivePathValidation = true
          // Add system-specific allowed directories here
          // Examples:
          // Windows: "C:\\Users\\YourName\\Projects", "D:\\Code"
          // Linux/Mac: "/home/user/projects", "/opt/projects"
        ],
        "Headers": {
          "EnableCsp": true,
          "CspDirective": "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self' data:; connect-src 'self'; frame-ancestors 'none'; base-uri 'self'; form-action 'self'",
          "EnableNoSniff": true,
          "EnableFrameOptions": true,
          "FrameOptionsValue": "DENY",
          "EnableXssProtection": true,
          "EnableReferrerPolicy": true,
          "ReferrerPolicyValue": "strict-origin-when-cross-origin",
          "EnablePermissionsPolicy": true,
          "PermissionsPolicyValue": "geolocation=(), microphone=(), camera=()",
          "EnableHsts": false,
          "HstsMaxAge": 31536000
        }
      },
      "AutoResumeIndexing": true,
      "AutoResumeDelay": 0,
      "JobMaintenance": {
        "MaxJobsPerProject": 50,
        "JobRetentionDays": 7,
        "EnableAutomaticCleanup": true
      },
      "IndexingPerformance": {
        "MaxConcurrentIndexingJobs": 2,
        "EmbeddingBatchSize": 50,
        "DefaultTokenBudget": 5000,
        "IndexingChunkSize": 1024,
        "MaxFileSizeMB": 100,
        "EnableParallelProcessing": true,
        "MaxDegreeOfParallelism": 4
      },
      "StorageCleanup": {
        "EnableAutomaticChunkCleanup": true,
        "VacuumDatabaseOnStartup": false,
        "MaxDatabaseSizeGB": 50,
        "EnableEmbeddingCompression": false,
        "EmbeddingCompressionDays": 30
      },
      "LoggingDiagnostics": {
        "EnableDetailedIndexingLogs": false,
        "LogRetentionDays": 30,
        "EnablePerformanceMetrics": true,
        "EnableQueryTracing": false,
        "SlowQueryThresholdMs": 1000
      },
      "ProjectResolution": {
        "AutoCreate": true,
        "AutoIndex": true,
        "MaxSizeGB": 10
      },
      "FileMonitoring": {
        "Enabled": true,
        "DebounceMilliseconds": 2000,
        "BatchWindowMilliseconds": 5000,
        "MaxConcurrentReindexOperations": 3,
        "MaxConcurrentFileWatchers": 10,
        "RestartOnFailure": true,
        "RestartDelayMilliseconds": 5000
      }
    },
    "Data": {
      "Weaviate": {
        "DefaultTopK": 10,
        "MaxTopK": 100,
        "Dimension": 384,
        "Metric": "cosine",
        "TimeoutSeconds": 30
      },
      "Sources": {
        "Default": {
          "Adapter": "sqlite",
          "ConnectionString": "Data Source=.koan/data/Koan.sqlite"
        }
      }
    },
    "AI": {
      "Embedding": {
        "Provider": "ollama",
        "Model": "all-minilm",
        "Endpoint": "http://localhost:11434"
      }
    },
    "Orchestration": {
      "Services": {
        "weaviate": "always"
      },
      "Weaviate": {
        "Image": "semitechnologies/weaviate:latest",
        "HostPort": 27501,
        "ContainerPort": 8080,
        "VolumeName": "koan-weaviate-data",
        "HealthCheckPath": "/v1/.well-known/ready",
        "Environment": {
          "QUERY_DEFAULTS_LIMIT": "25",
          "AUTHENTICATION_ANONYMOUS_ACCESS_ENABLED": "true",
          "PERSISTENCE_DATA_PATH": "/var/lib/weaviate",
          "DEFAULT_VECTORIZER_MODULE": "none",
          "ENABLE_MODULES": "",
          "CLUSTER_HOSTNAME": "node1"
        }
      }
    },
    "Mcp": {
      "EnableStdioTransport": true,
      "EnableHttpSseTransport": true,
      "RequireAuthentication": false,
      "EnableCors": false,
      "AllowedOrigins": [],
      "PublishCapabilityEndpoint": true,
      "HttpSseRoute": "/mcp",
      "CodeMode": {
        "Enabled": true,
        "Runtime": "Jint",
        "PublishSdkEndpoint": true,
        "Sandbox": {
          "CpuMilliseconds": 2000,
          "MemoryMegabytes": 64,
          "MaxRecursionDepth": 100,
          "MaxCodeLength": 50000
        },
        "MaxSdkCalls": 100,
        "MaxLogEntries": 50,
        "RequireAnswer": true
      }
    }
  }
}
