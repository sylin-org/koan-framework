# S13.DocMind Proposal vs. Implementation Assessment

## 1. Method
- Reviewed the S13.DocMind proposal package (`docs/chunks/S13-DocMind`) with emphasis on the domain blueprint, AI pipeline plan, and infrastructure guidance to understand the intended layered architecture.【F:docs/chunks/S13-DocMind/02_entity_models.md†L1-L176】【F:docs/chunks/S13-DocMind/03_ai_processing.md†L1-L83】【F:docs/chunks/S13-DocMind/05_infrastructure.md†L1-L112】
- Inspected the latest sample implementation in `samples/S13.DocMind`, covering domain models, pipeline services, controllers, and bootstrap code to map real behaviors and dependencies.【F:samples/S13.DocMind/Models/SourceDocument.cs†L1-L200】【F:samples/S13.DocMind/Infrastructure/DocumentProcessingWorker.cs†L1-L470】【F:samples/S13.DocMind/Controllers/DocumentsController.cs†L1-L136】【F:samples/S13.DocMind/Program.cs†L1-L36】

## 2. Proposal pillars (condensed)
1. **Domain parity** – Adopt `SourceDocument`, `DocumentChunk`, `DocumentInsight`, and `DocumentProcessingEvent` entities with Koan auto-adapter support and vector data delegated to dedicated `[VectorAdapter("weaviate")]` models.【F:docs/chunks/S13-DocMind/02_entity_models.md†L15-L175】
2. **Lean orchestration** – Replace bespoke channel queues with a single `DocumentProcessingWorker` that coordinates focused services (`TextExtractionService`, `VisionInsightService`, `InsightSynthesisService`, `TemplateSuggestionService`) through the Koan AI abstractions and emits persisted timeline events.【F:docs/chunks/S13-DocMind/03_ai_processing.md†L3-L66】
3. **Auto-registered infrastructure** – Keep `Program.cs` minimal with only `AddKoan()`, delegating all service wiring, options binding, and MCP configuration to auto-registrars that honor the `DocMind:` configuration hierarchy.【F:docs/chunks/S13-DocMind/05_infrastructure.md†L14-L28】
4. **Discovery built on DocMind entities** – Query analytics from the new document/insight collections (plus optional vector adapters) instead of the deprecated `File/Analysis/DocumentType` schema.【F:docs/chunks/S13-DocMind/02_entity_models.md†L3-L175】

## 3. Implementation snapshot (current state)
- `DocumentProcessingWorker` now drives each stage against the durable `DocumentProcessingJob` ledger, recording per-stage telemetry, queue age, and token metrics that diagnostics surface through paged `/processing/queue` responses and stage-targeted retries.【F:samples/S13.DocMind/Infrastructure/DocumentProcessingWorker.cs†L1-L620】【F:samples/S13.DocMind/Models/DocumentProcessingJob.cs†L1-L190】【F:samples/S13.DocMind/Services/ProcessingDiagnosticsService.cs†L1-L260】【F:samples/S13.DocMind/Controllers/ProcessingController.cs†L1-L120】 Replay tooling still needs dedicated CLI/test coverage, but the ledger now matches the blueprint.
- Discovery dashboards build and reuse a cached `DocumentDiscoveryProjection`, and `DocumentInsightsService` now reads from that projection instead of scanning every collection on each request.【F:samples/S13.DocMind/Services/DocumentDiscoveryProjectionBuilder.cs†L1-L220】【F:samples/S13.DocMind/Services/DocumentInsightsService.cs†L1-L150】 Change detection now skips redundant rescans and surfaces refresh timing/queue metadata, yet the worker still invokes the refresh inline and the incremental path lacks load validation.
- Template suggestions delegate to the configured vector adapter, capture latency diagnostics, and fall back to cosine similarity when adapters are offline, but the bootstrapper still ignores semantic profile embeddings and no readiness telemetry is published yet.【F:samples/S13.DocMind/Services/TemplateSuggestionService.cs†L120-L320】【F:samples/S13.DocMind/Infrastructure/DocumentProcessingWorker.cs†L500-L620】【F:samples/S13.DocMind/Infrastructure/DocumentVectorBootstrapper.cs†L1-L60】
- Operational hardening and test scaffolding remain incomplete. `DocMindRegistrar` still emits only configuration details, health checks and telemetry wiring are missing, and there is no DocMind-focused automated test suite as laid out in the testing plan.【F:samples/S13.DocMind/Infrastructure/DocMindRegistrar.cs†L30-L90】【docs/chunks/S13-DocMind/07_testing_ops.md†L1-L110】

## 4. Gaps, contradictions, and aligned remediation

| Area | Proposal expectation | Current implementation | Impact | Recommended implementation |
|------|----------------------|------------------------|--------|----------------------------|
| Replay-ready diagnostics | Stage-aware ledger plus diagnostics deliver per-stage telemetry, paging, and replay hooks for MCP tooling.【F:docs/chunks/S13-DocMind/03_ai_processing.md†L12-L66】【F:docs/chunks/S13-DocMind/04_api_ui_design.md†L1-L52】 | Worker, ledger, and diagnostics now expose paged queue slices with stage snapshots, but replay/CLI tooling and automated coverage for resume flows are still missing.【F:samples/S13.DocMind/Infrastructure/DocumentProcessingWorker.cs†L1-L620】【F:samples/S13.DocMind/Controllers/ProcessingController.cs†L1-L120】 | Without end-to-end replay tooling, operators still rely on manual intervention when jobs stall. | Finish the documented CLI/APIs for stage-targeted resumes and add automated tests that exercise the persisted telemetry paths. |
| Discovery refresh efficiency | Discovery should rely on lightweight projections with freshness metadata instead of full-table scans.【F:docs/chunks/S13-DocMind/02_entity_models.md†L160-L182】 | Change-aware refreshes now short-circuit redundant rebuilds and expose `refreshedAt`/queue metadata, but the worker still executes the rebuild synchronously and there are no load tests confirming the incremental path’s accuracy.【F:samples/S13.DocMind/Services/DocumentDiscoveryProjectionBuilder.cs†L1-L220】【F:samples/S13.DocMind/Infrastructure/DocumentProcessingWorker.cs†L600-L648】 | Inline refreshes can still slow completions under load, and the new heuristics remain unvalidated on production-sized data. | Move the refresh onto a scheduled job or throttled signal and add scale tests that verify projection accuracy/perf. |
| Vector readiness & health | Template suggestions are adapter-first with bootstrap routines ensuring embeddings exist and degraded modes are observable.【F:docs/chunks/S13-DocMind/03_ai_processing.md†L38-L66】【F:docs/chunks/S13-DocMind/05_infrastructure.md†L5-L28】 | Vector search now powers suggestions with telemetry and fallbacks, but profile embeddings are not bootstrapped and adapter health is still opaque.【F:samples/S13.DocMind/Services/TemplateSuggestionService.cs†L120-L320】【F:samples/S13.DocMind/Infrastructure/DocumentVectorBootstrapper.cs†L1-L60】 | Missing embeddings or degraded adapters will silently remove auto-classification without operator awareness. | Extend the bootstrapper to seed/repair semantic profile vectors and publish adapter readiness through diagnostics/registrar outputs. |
| Operations & quality gates | Registrar emits health probes, adapter readiness, and telemetry wiring; dedicated S13.DocMind tests validate pipeline behavior.【F:docs/chunks/S13-DocMind/05_infrastructure.md†L40-L112】【F:docs/chunks/S13-DocMind/07_testing_ops.md†L1-L110】 | Boot report still lists configuration only, health checks are absent, and no DocMind-specific automated tests exist.【F:samples/S13.DocMind/Infrastructure/DocMindRegistrar.cs†L30-L90】【docs/chunks/S13-DocMind/07_testing_ops.md†L1-L110】 | Operators lack readiness signals, and CI cannot guard the refactored pipeline. | Wire up health/telemetry registration in the registrar and land the proposal’s test suites with fake AI/vector providers. |

## 5. Additional contradictions & follow-on needs
- **Projection validation still pending** – The builder now short-circuits unchanged snapshots and records refresh timing, yet the inline worker invocation and lack of large-sample validation leave throughput and accuracy risks.【F:samples/S13.DocMind/Services/DocumentDiscoveryProjectionBuilder.cs†L1-L220】【F:samples/S13.DocMind/Infrastructure/DocumentProcessingWorker.cs†L600-L648】
- **Vector bootstrap limitations** – `DocumentVectorBootstrapper` only checks chunk embeddings and never validates semantic profile vectors, so template suggestions can silently degrade.【F:samples/S13.DocMind/Infrastructure/DocumentVectorBootstrapper.cs†L1-L60】 Extend bootstrap coverage to include profile embeddings, emit adapter readiness diagnostics, and surface vector stats akin to S5.Recs’ `SeedService` which uses `Vector<T>.Stats` to validate availability.【F:samples/S5.Recs/Services/SeedService.cs†L288-L320】
- **Telemetry-lite registrar** – `DocMindRegistrar.Describe` surfaces configuration strings but omits OpenTelemetry wiring or ASP.NET health checks promised in the infrastructure guide.【F:samples/S13.DocMind/Infrastructure/DocMindRegistrar.cs†L30-L90】【F:docs/chunks/S13-DocMind/05_infrastructure.md†L40-L112】 Wire up health checks, trace instrumentation, and boot-failure gates to match the documented ops story.

## 6. Prioritized remediation sequence
1. **Harden discovery projections** – Validate the new projection builder against larger datasets, add incremental refresh/save suppression, and ensure dashboards consume the cached projection confidently.
2. **Complete vector readiness** – Extend the bootstrapper to manage semantic profile embeddings, surface adapter health through diagnostics/registrar outputs, and backfill tests for vector/fallback paths.
3. **Close operations & testing gaps** – Wire health/telemetry registration into the registrar and land the DocMind-focused unit/integration suites so the refactored pipeline has observable, testable guardrails.

This sequence keeps the refactored ledger stable while finishing the discovery, vector, and operational deltas still diverging from the proposal.
