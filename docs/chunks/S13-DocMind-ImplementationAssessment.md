# S13.DocMind Proposal vs. Implementation Assessment (Updated)

## 1. Method
- Reviewed the refactoring proposal package (`docs/chunks/S13-DocMind`) to restate the intended data model, AI orchestration, and multi-document synthesis patterns that should anchor both the API surface and the client experience.【F:docs/chunks/S13-DocMind/02_entity_models.md†L1-L176】【F:docs/chunks/S13-DocMind/03_ai_processing.md†L1-L83】【F:docs/chunks/S13-DocMind/Implementation_Examples_GDoc_Integration.md†L520-L599】
- Scanned the sample implementation, including hosted workers, services, controllers, and Angular assets, to map the current behaviors and surface contract drift or UX gaps.【F:samples/S13.DocMind/Infrastructure/DocumentProcessingWorker.cs†L17-L200】【F:samples/S13.DocMind/Services/DocumentIntakeService.cs†L38-L184】【F:samples/S13.DocMind/Controllers/DocumentsController.cs†L17-L171】【F:samples/S13.DocMind/wwwroot/app/app.js†L1-L44】
- Executed a targeted UI audit across dashboard, analysis, templates, and configuration flows to confirm whether the Angular experience reflects the new `SourceDocument`/`DocumentInsight` vocabulary and the proposal’s manual multi-document objectives.【F:samples/S13.DocMind/wwwroot/app/controllers/analysisController.js†L1-L158】【F:samples/S13.DocMind/wwwroot/app/views/dashboard/index.html†L13-L131】【F:samples/S13.DocMind/wwwroot/app/controllers/configurationController.js†L12-L88】

## 2. Proposal pillars (condensed)
1. **Document-first domain** – Adopt the `SourceDocument`, `DocumentChunk`, `DocumentInsight`, and `DocumentProcessingEvent` entities with auto-registered adapters so queue orchestration and dashboards share the same vocabulary.【F:docs/chunks/S13-DocMind/02_entity_models.md†L33-L176】
2. **Resilient background ledger** – Drive extraction, embeddings, vision, and insight synthesis through the durable `DocumentProcessingJob` ledger that records metrics for diagnostics and replay automation.【F:docs/chunks/S13-DocMind/03_ai_processing.md†L3-L66】
3. **Synthesis & prompting patterns** – Reuse the delimiter-driven, schema-safe prompting models captured from the GDoc reference to support both per-document and multi-document consolidation flows.【F:docs/chunks/S13-DocMind/Implementation_Examples_GDoc_Integration.md†L520-L599】
4. **Unified operator experience** – Align REST, MCP, and Angular clients with the same DTOs so dashboards, manual analysis management, templates, file browsing, and configuration screens all expose the new domain concepts.【F:docs/chunks/S13-DocMind/04_api_ui_design.md†L1-L108】

## 3. Implementation snapshot (current state)
- The hosted `DocumentProcessingWorker` iterates the durable ledger, materialising each stage with scoped services (`TextExtractionService`, `EmbeddingGenerator`, `VisionInsightService`, `InsightSynthesisService`, `TemplateSuggestionService`) and recording telemetry snapshots, matching the resilient pipeline called for in the proposal.【F:samples/S13.DocMind/Infrastructure/DocumentProcessingWorker.cs†L36-L200】【F:samples/S13.DocMind/Models/DocumentProcessingJob.cs†L18-L199】
- Intake flows deduplicate uploads, persist `SourceDocument` summaries, emit processing events, and enqueue ledger work items, proving the entity-first persistence pattern is in place.【F:samples/S13.DocMind/Services/DocumentIntakeService.cs†L38-L155】【F:samples/S13.DocMind/Models/SourceDocument.cs†L12-L120】【F:samples/S13.DocMind/Models/DocumentProcessingEvent.cs†L13-L70】
- Discovery dashboards and diagnostics reuse cached `DocumentDiscoveryProjection` data and expose queue/timeline metadata, although the projection still refreshes by scanning the entire corpus.【F:samples/S13.DocMind/Services/DocumentDiscoveryProjectionBuilder.cs†L52-L181】【F:samples/S13.DocMind/Services/DocumentInsightsService.cs†L30-L115】【F:samples/S13.DocMind/Services/ProcessingDiagnosticsService.cs†L14-L165】
- Unit/integration harnesses cover the ledger happy-path, confirming upload→completion behaviour and replay scaffolding even though CI still lacks full HTTP/MCP automation.【F:tests/S13.DocMind.IntegrationTests/DocMindProcessingHarnessTests.cs†L15-L71】
- Model management APIs surface catalog, installation queue, and provider status data, while the Angular configuration shell renders tabs for AI models, storage, processing, and security—yet persistence remains a stubbed promise.【F:samples/S13.DocMind/Controllers/ModelsController.cs†L27-L126】【F:samples/S13.DocMind/wwwroot/app/controllers/configurationController.js†L12-L152】【F:samples/S13.DocMind/wwwroot/app/services/configurationService.js†L56-L105】

## 4. Gaps, contradictions, and aligned remediation

| Area | Proposal expectation | Current implementation | Impact | Recommended remediation |
|------|----------------------|------------------------|--------|----------------------------|
| Manual multi-document analysis | Manual analysis management screens should let operators assemble curated sets of documents, run multi-document synthesis prompts, and persist the results distinct from auto-generated per-file insights.【F:docs/chunks/S13-DocMind/Implementation_Examples_GDoc_Integration.md†L520-L599】 | Angular analysis routes still list individual `DocumentInsight` records, enriching them with legacy `fileId`/`typeId` lookups and bulk export actions meant for the deprecated schema.【F:samples/S13.DocMind/wwwroot/app/controllers/analysisController.js†L1-L158】【F:samples/S13.DocMind/wwwroot/app/views/analysis/list.html†L13-L124】 | Users cannot create, view, or edit the manual multi-document syntheses promised by the proposal; the UI continues to expose auto-generated insights and legacy vocabulary. | Introduce a dedicated manual-analysis entity/service, extend synthesis APIs to accept multi-document requests, and rebuild the analysis UI around session creation, document selection, prompt execution, and revision history. |
| Front-end contract alignment | Dashboard, document management, and template galleries should speak the `SourceDocument`/`SemanticTypeProfile` language and use regenerated DTOs from the Koan controllers.【F:docs/chunks/S13-DocMind/04_api_ui_design.md†L1-L108】 | Client services/controllers still expect `file.state`, `typeId`, and other legacy fields, and the router has no “new analysis” wizard or updated naming. Templates remain bound to `/document-types` endpoints and inconsistent property names.【F:samples/S13.DocMind/wwwroot/app/services/documentService.js†L24-L130】【F:samples/S13.DocMind/wwwroot/app/app.js†L12-L43】【F:samples/S13.DocMind/wwwroot/app/services/templateService.js†L1-L78】 | Angular components mislabel data (e.g., status badges, type names) and cannot take advantage of the richer summaries stored on `SourceDocument`, eroding confidence in the dashboard metrics. | Regenerate TypeScript clients from OpenAPI, rename services/models to `SourceDocument`/`SemanticTypeProfile`, and refactor controllers/views to consume the new DTOs and timeline endpoints. |
| Configuration lifecycle | Operators should edit the `DocMind` options (storage, processing, AI) backed by registrar-validated configuration, with model install queues reflecting real provider health.【F:docs/chunks/S13-DocMind/05_infrastructure.md†L5-L109】 | The configuration UI seeds static defaults and `updateConfiguration` returns a resolved promise; none of the inputs persist to `DocMindOptions`, which remains server-side only.【F:samples/S13.DocMind/wwwroot/app/controllers/configurationController.js†L12-L152】【F:samples/S13.DocMind/wwwroot/app/services/configurationService.js†L56-L105】【F:samples/S13.DocMind/Infrastructure/DocMindOptions.cs†L6-L84】 | Operators receive the illusion of configurability without any persistence, making the dashboard misleading and hindering workshop demos. | Implement real configuration endpoints mapped to `DocMindOptions`, persist edits, and surface the registrar snapshot so UI changes reflect actual runtime state. |
| Prompting & synthesis consistency | Multi-document prompting should follow the delimiter patterns and metadata captured from the GDoc reference, ensuring structured payloads feed dashboards and manual sessions.【F:docs/chunks/S13-DocMind/Implementation_Examples_GDoc_Integration.md†L520-L599】 | `InsightSynthesisService` still operates per document, producing fallback snippets and chunk highlights without the delimiter-driven multi-document payloads, leaving manual aggregation unimplemented.【F:samples/S13.DocMind/Services/InsightSynthesisService.cs†L29-L170】 | Manual analysis workflows cannot rely on consistent schema outputs, and dashboards miss the consolidated findings expected by the proposal. | Extend synthesis services with multi-document prompts, capture delimiter-parsed payloads, and expose them through new manual-analysis APIs/UI. |
| Discovery refresh efficiency | Discovery projections should refresh incrementally, avoiding full collection scans while surfacing freshness metadata for the dashboard.【F:docs/chunks/S13-DocMind/02_entity_models.md†L160-L182】 | `DocumentDiscoveryProjectionBuilder` still loads all documents/insights into memory before computing aggregates, only short-circuiting when no changes are detected.【F:samples/S13.DocMind/Services/DocumentDiscoveryProjectionBuilder.cs†L52-L181】 | Scaling to larger corpora will create long-running refresh windows and stale dashboards, undermining operator trust. | Implement incremental projections (e.g., using change windows per collection), persist freshness metrics, and wire drift alerts into diagnostics. |
| Observability & CI guardrails | The registrar should light up OpenTelemetry exports, smoke tests, and health telemetry so compose runs and CI enforce quality gates.【F:docs/chunks/S13-DocMind/07_testing_ops.md†L1-L110】 | Registrar wires health checks and vector snapshots, but no tracing/metrics exporters exist, and integration tests run only through the harness without HTTP/MCP automation.【F:samples/S13.DocMind/Infrastructure/DocMindRegistrar.cs†L23-L118】【F:tests/S13.DocMind.IntegrationTests/DocMindProcessingHarnessTests.cs†L15-L71】 | Lacking observability and CI coverage keeps the sample brittle under regressions or infrastructure drift. | Add OpenTelemetry configuration, publish exporter instructions, and automate HTTP/MCP smoke suites plus replay tooling in CI. |

## 5. Additional contradictions & follow-on needs
- **Manual analysis entity absent** – Neither the domain model nor the API exposes a first-class manual analysis resource; the UI cannot separate curated syntheses from auto insights until such an entity, service, and controller exist.【F:samples/S13.DocMind/Controllers/AnalysisController.cs†L13-L39】【F:samples/S13.DocMind/wwwroot/app/controllers/analysisController.js†L1-L158】 
- **Angular vocabulary drift** – Dashboard and document views still reference legacy fields (`documentTypeName`, `doc.name`, `file.state`), causing inconsistent labelling versus the `SourceDocument` summary properties the backend now maintains.【F:samples/S13.DocMind/wwwroot/app/views/dashboard/index.html†L88-L125】【F:samples/S13.DocMind/wwwroot/app/controllers/documentsController.js†L1-L99】
- **Configuration illusion** – Without wiring to `DocMindOptions`, toggles for concurrency, storage, or AI models fail silently; the UI should fetch the registrar snapshot and persist edits so operators trust the feedback loop.【F:samples/S13.DocMind/wwwroot/app/services/configurationService.js†L56-L105】【F:samples/S13.DocMind/Infrastructure/DocMindOptions.cs†L6-L84】

## 6. Prioritized remediation sequence
1. **Ship manual analysis management** – Add domain/controller/service support for manual multi-document sessions, extend synthesis prompts, and rebuild the analysis UI around the new workflow and DTOs.
2. **Realign Angular contracts** – Regenerate clients, rename services/views to `SourceDocument`/`SemanticTypeProfile`, and update dashboard/document/templates screens to consume the new summaries and timeline endpoints.
3. **Close configuration & prompting gaps** – Persist `DocMindOptions` edits, surface registrar telemetry, and adopt the delimiter-driven prompts across synthesis and template tooling.
4. **Optimize discovery & observability** – Replace full scans with incremental projections and light up OpenTelemetry plus CI smoke suites to harden operations.

This assessment keeps the emphasis on delivering the manual multi-document experience and contract alignment that remain unfulfilled despite the substantial progress on the pipeline and diagnostics layers.
