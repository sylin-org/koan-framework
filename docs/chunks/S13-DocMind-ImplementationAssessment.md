# S13.DocMind Proposal vs. Implementation Assessment

## 1. Method
- Reviewed the S13.DocMind proposal package (`docs/chunks/S13-DocMind`) with emphasis on the domain blueprint, AI pipeline plan, and infrastructure guidance to understand the intended layered architecture.【F:docs/chunks/S13-DocMind/02_entity_models.md†L1-L176】【F:docs/chunks/S13-DocMind/03_ai_processing.md†L1-L83】【F:docs/chunks/S13-DocMind/05_infrastructure.md†L1-L112】
- Inspected the latest sample implementation in `samples/S13.DocMind`, covering domain models, pipeline services, controllers, and bootstrap code to map real behaviors and dependencies.【F:samples/S13.DocMind/Models/SourceDocument.cs†L1-L200】【F:samples/S13.DocMind/Infrastructure/DocumentProcessingWorker.cs†L1-L470】【F:samples/S13.DocMind/Controllers/DocumentsController.cs†L1-L136】【F:samples/S13.DocMind/Program.cs†L1-L36】

## 2. Proposal pillars (condensed)
1. **Domain parity** – Adopt `SourceDocument`, `DocumentChunk`, `DocumentInsight`, and `DocumentProcessingEvent` entities with Koan auto-adapter support and vector data delegated to dedicated `[VectorAdapter("weaviate")]` models.【F:docs/chunks/S13-DocMind/02_entity_models.md†L15-L175】
2. **Lean orchestration** – Replace bespoke channel queues with a single `DocumentProcessingWorker` that coordinates focused services (`TextExtractionService`, `VisionInsightService`, `InsightSynthesisService`, `TemplateSuggestionService`) through the Koan AI abstractions and emits persisted timeline events.【F:docs/chunks/S13-DocMind/03_ai_processing.md†L3-L66】
3. **Auto-registered infrastructure** – Keep `Program.cs` minimal with only `AddKoan()`, delegating all service wiring, options binding, and MCP configuration to auto-registrars that honor the `DocMind:` configuration hierarchy.【F:docs/chunks/S13-DocMind/05_infrastructure.md†L14-L28】
4. **Discovery built on DocMind entities** – Query analytics from the new document/insight collections (plus optional vector adapters) instead of the deprecated `File/Analysis/DocumentType` schema.【F:docs/chunks/S13-DocMind/02_entity_models.md†L3-L175】

## 3. Implementation snapshot (current state)
- `DocumentProcessingWorker` now drives each stage against the durable `DocumentProcessingJob` ledger, recording per-stage telemetry, queue age, and token metrics that diagnostics surface through paged `/processing/queue` responses and stage-targeted retries.【F:samples/S13.DocMind/Infrastructure/DocumentProcessingWorker.cs†L1-L760】【F:samples/S13.DocMind/Models/DocumentProcessingJob.cs†L1-L206】【F:samples/S13.DocMind/Services/ProcessingDiagnosticsService.cs†L1-L360】【F:samples/S13.DocMind/Controllers/ProcessingController.cs†L1-L160】 Replay tooling now includes an operator CLI skeleton, but automated verification of replay flows is still pending.
- Discovery dashboards build and reuse a cached `DocumentDiscoveryProjection`, and `DocumentInsightsService` now reads from that projection instead of scanning every collection on each request.【F:samples/S13.DocMind/Services/DocumentDiscoveryProjectionBuilder.cs†L1-L220】【F:samples/S13.DocMind/Services/DocumentInsightsService.cs†L1-L120】 `DocumentDiscoveryRefreshService` decouples refresh execution, tracks queue metrics, and exposes a validation endpoint/CLI hook, yet large corpus validation still needs to run.
- Template suggestions delegate to the configured vector adapter, capture latency diagnostics, and fall back to cosine similarity when adapters are offline. The new `DocMindVectorHealth` tracker feeds readiness into diagnostics, health checks, and boot reports, but CI still lacks vector/fallback coverage.【F:samples/S13.DocMind/Services/TemplateSuggestionService.cs†L1-L360】【F:samples/S13.DocMind/Infrastructure/DocMindVectorHealth.cs†L1-L120】【samples/S13.DocMind/wwwroot/openapi.json†L1-L520】
- Operational hardening is partially in place: storage/vector/discovery health checks register, the boot report lists readiness totals, and DocMind-focused unit/integration projects now exist (with integration tests marked pending until infrastructure is available). Telemetry exporters and runnable regression suites still need to be wired per the testing plan.【F:samples/S13.DocMind/Infrastructure/DocMindRegistrar.cs†L1-L120】【samples/S13.DocMind/Infrastructure/HealthChecks.cs†L1-L120】【tests/S13.DocMind.UnitTests/DocumentDiscoveryRefreshServiceTests.cs†L1-L80】【tests/S13.DocMind.IntegrationTests/ReplayWorkflowTests.cs†L1-L26】

## 4. Gaps, contradictions, and aligned remediation

| Area | Proposal expectation | Current implementation | Impact | Recommended implementation |
|------|----------------------|------------------------|--------|----------------------------|
| Replay-ready diagnostics | Stage-aware ledger plus diagnostics deliver per-stage telemetry, paging, and replay hooks for MCP tooling.【F:docs/chunks/S13-DocMind/03_ai_processing.md†L12-L66】【F:docs/chunks/S13-DocMind/04_api_ui_design.md†L1-L52】 | `/processing/replay` targets stages via the durable ledger, the CLI project can enqueue replays, and integration tests are scaffolded (skipped) until infrastructure is available; automated verification is still pending.【F:samples/S13.DocMind/Services/ProcessingDiagnosticsService.cs†L260-L520】【samples/S13.DocMind.Tools/Program.cs†L1-L140】【tests/S13.DocMind.IntegrationTests/ReplayWorkflowTests.cs†L1-L26】 | Without runnable automation, operators must manually verify that replays honour persisted telemetry. | Finish the CLI wiring and land regression tests that assert replay telemetry through diagnostics APIs once the runtime is available. |
| Discovery refresh efficiency | Discovery should rely on lightweight projections with freshness metadata instead of full-table scans.【F:docs/chunks/S13-DocMind/02_entity_models.md†L160-L182】 | Refreshes now run asynchronously through `DocumentDiscoveryRefreshService`, capture backlog/latency history, and expose a validation endpoint/CLI hook, yet incremental accuracy is still untested at scale.【F:samples/S13.DocMind/Infrastructure/DocumentDiscoveryRefreshService.cs†L1-L180】【F:samples/S13.DocMind/Services/DocumentDiscoveryRefresher.cs†L1-L160】【samples/S13.DocMind/wwwroot/openapi.json†L1-L520】 | Without load validation the projection could drift or backlog under production workloads. | Exercise the incremental refresh path against captured datasets, publish the recorded metrics in diagnostics dashboards, and tune scheduler throttles. |
| Vector readiness & health | Template suggestions are adapter-first with bootstrap routines ensuring embeddings exist and degraded modes are observable.【F:docs/chunks/S13-DocMind/03_ai_processing.md†L38-L66】【F:docs/chunks/S13-DocMind/05_infrastructure.md†L5-L28】 | Semantic profile embeddings are backfilled, `DocMindVectorHealth` surfaces adapter/fallback telemetry via APIs/health checks, and unit tests cover readiness snapshots; CI still lacks adapter/fallback smoke coverage.【F:samples/S13.DocMind/Infrastructure/DocumentVectorBootstrapper.cs†L1-L180】【F:samples/S13.DocMind/Infrastructure/DocMindVectorHealth.cs†L1-L120】【tests/S13.DocMind.UnitTests/DocMindVectorHealthTests.cs†L1-L34】 | Without automated guardrails future regressions could reintroduce silent vector outages. | Add adapter/fallback smoke tests (leveraging fake providers) and feed the published health snapshots into dashboards/alerts. |
| Operations & quality gates | Registrar emits health probes, adapter readiness, and telemetry wiring; dedicated S13.DocMind tests validate pipeline behavior.【F:docs/chunks/S13-DocMind/05_infrastructure.md†L40-L112】【F:docs/chunks/S13-DocMind/07_testing_ops.md†L1-L110】 | Storage/vector/discovery health checks now register, the boot report exposes readiness totals, and DocMind-focused unit/integration projects are checked in (integration marked pending). Telemetry exporters and runnable regression suites are still missing.【F:samples/S13.DocMind/Infrastructure/DocMindRegistrar.cs†L1-L120】【tests/S13.DocMind.UnitTests/DocumentDiscoveryRefreshServiceTests.cs†L1-L80】【tests/S13.DocMind.IntegrationTests/ReplayWorkflowTests.cs†L1-L26】 | Lack of telemetry and test execution keeps the sample brittle under failures or refactors. | Wire OpenTelemetry exporters for the sample and light up the new test suites in CI with fake providers. |

## 5. Additional contradictions & follow-on needs
- **Projection validation still pending** – The scheduler now decouples refresh execution and records backlog history, yet the new validation endpoint/CLI hook still needs to exercise production-sized corpora before we can trust incremental heuristics.【F:samples/S13.DocMind/Infrastructure/DocumentDiscoveryRefreshService.cs†L1-L180】【F:samples/S13.DocMind/Services/DocumentDiscoveryRefresher.cs†L1-L160】
- **Replay automation gap** – Replay endpoints and CLI scaffolding exist, but automated coverage that proves resumability across upgrades remains missing until infrastructure is wired for tests.【F:samples/S13.DocMind.Tools/Program.cs†L1-L140】【tests/S13.DocMind.IntegrationTests/ReplayWorkflowTests.cs†L1-L26】
- **Telemetry-lite registrar** – Health checks now register, but OpenTelemetry exporters and runnable DocMind test suites are still missing, so the ops story remains partially manual.【F:samples/S13.DocMind/Infrastructure/DocMindRegistrar.cs†L1-L120】【docs/chunks/S13-DocMind/07_testing_ops.md†L1-L110】 Wire tracing/metrics and light up the new unit/integration projects in CI to close the loop.

## 6. Prioritized remediation sequence
1. **Harden discovery projections** – Validate the new projection builder against larger datasets, add incremental refresh/save suppression, and ensure dashboards consume the cached projection confidently.
2. **Complete vector readiness** – Extend the bootstrapper to manage semantic profile embeddings, surface adapter health through diagnostics/registrar outputs, and backfill tests for vector/fallback paths.
3. **Close operations & testing gaps** – Wire health/telemetry registration into the registrar and land the DocMind-focused unit/integration suites so the refactored pipeline has observable, testable guardrails.

This sequence keeps the refactored ledger stable while finishing the discovery, vector, and operational deltas still diverging from the proposal.
