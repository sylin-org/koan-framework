{
  "openapi": "3.0.1",
  "info": {
    "title": "S13.DocMind API",
    "version": "1.0.0",
    "description": "API surface for document insights, processing diagnostics, and model management."
  },
  "paths": {
    "/api/insights/overview": {
      "get": {
        "summary": "Retrieve high level document insights",
        "operationId": "getInsightsOverview",
        "responses": {
          "200": {
            "description": "Overview metrics",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/DocumentInsightsOverview"
                }
              }
            }
          }
        }
      }
    },
    "/api/insights/profiles/{profileId}": {
      "get": {
        "summary": "Get profile collection summaries",
        "operationId": "getInsightsProfile",
        "parameters": [
          {
            "name": "profileId",
            "in": "path",
            "required": true,
            "schema": { "type": "string" }
          }
        ],
        "responses": {
          "200": {
            "description": "Collection summaries",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/DocumentCollectionSummary"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/insights/feeds": {
      "get": {
        "summary": "Get aggregation feed items",
        "operationId": "getInsightsFeeds",
        "responses": {
          "200": {
            "description": "Feed entries",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/AggregationFeedItem"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/processing/queue": {
      "get": {
        "summary": "Get processing queue diagnostics",
        "operationId": "getProcessingQueue",
        "parameters": [
          { "name": "page", "in": "query", "schema": { "type": "integer", "minimum": 1 } },
          { "name": "pageSize", "in": "query", "schema": { "type": "integer", "minimum": 1, "maximum": 100 } },
          {
            "name": "status",
            "in": "query",
            "schema": {
              "type": "array",
              "items": { "type": "string" }
            },
            "style": "form",
            "explode": true
          },
          {
            "name": "stage",
            "in": "query",
            "schema": {
              "type": "array",
              "items": { "type": "string" }
            },
            "style": "form",
            "explode": true
          },
          { "name": "correlationId", "in": "query", "schema": { "type": "string" } },
          { "name": "documentId", "in": "query", "schema": { "type": "string" } },
          { "name": "includeCompleted", "in": "query", "schema": { "type": "boolean" } },
          { "name": "includeFuture", "in": "query", "schema": { "type": "boolean" } }
        ],
        "responses": {
          "200": {
            "description": "Queue page",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ProcessingQueueResult" }
              }
            }
          }
        }
      }
    },
    "/api/processing/timeline": {
      "get": {
        "summary": "Get processing timelines",
        "operationId": "getProcessingTimeline",
        "parameters": [
          { "name": "documentId", "in": "query", "schema": { "type": "string" } },
          { "name": "stage", "in": "query", "schema": { "type": "string" } },
          { "name": "from", "in": "query", "schema": { "type": "string", "format": "date-time" } },
          { "name": "to", "in": "query", "schema": { "type": "string", "format": "date-time" } }
        ],
        "responses": {
          "200": {
            "description": "Timeline entries",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": { "$ref": "#/components/schemas/ProcessingTimelineEntry" }
                }
              }
            }
          }
        }
      }
    },
    "/api/processing/{fileId}/retry": {
      "post": {
        "summary": "Retry a document in the processing pipeline",
        "operationId": "postProcessingRetry",
        "parameters": [
          {
            "name": "fileId",
            "in": "path",
            "required": true,
            "schema": { "type": "string" }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/ProcessingRetryRequest" }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Retry accepted",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "fileId": { "type": "string" },
                    "fileStatus": { "type": "string" },
                    "analysisStatus": { "type": "string" }
                  }
                }
              }
            }
          },
          "404": {
            "description": "File not found"
          }
        }
      }
    },
    "/api/models/available": {
      "get": {
        "summary": "Get available models",
        "operationId": "getModelsAvailable",
        "responses": {
          "200": {
            "description": "Available models",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": { "$ref": "#/components/schemas/ModelDescriptor" }
                }
              }
            }
          }
        }
      }
    },
    "/api/models/{modelName}/install": {
      "post": {
        "summary": "Queue model installation",
        "operationId": "postModelInstall",
        "parameters": [
          { "name": "modelName", "in": "path", "required": true, "schema": { "type": "string" } }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/InstallModelRequest" }
            }
          }
        },
        "responses": {
          "202": {
            "description": "Installation queued",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ModelInstallationStatus" }
              }
            }
          },
          "404": { "description": "Model not found" }
        }
      }
    },
    "/api/models/installations": {
      "get": {
        "summary": "List model installation statuses",
        "operationId": "getModelInstallations",
        "responses": {
          "200": {
            "description": "Installation statuses",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": { "$ref": "#/components/schemas/ModelInstallationStatus" }
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "DocumentInsightsOverview": {
        "type": "object",
        "properties": {
          "totalDocuments": { "type": "integer" },
          "completedDocuments": { "type": "integer" },
          "activeDocuments": { "type": "integer" },
          "failedDocuments": { "type": "integer" },
          "averageConfidence": { "type": "number" },
          "averageProcessingTimeMs": { "type": "number" },
          "highQualityDocumentCount": { "type": "integer" },
          "reviewRequiredCount": { "type": "integer" },
          "topDocumentTypes": {
            "type": "array",
            "items": { "$ref": "#/components/schemas/DocumentTypeUsage" }
          },
          "recentDocuments": {
            "type": "array",
            "items": { "$ref": "#/components/schemas/RecentDocumentInsight" }
          }
        }
      },
      "DocumentTypeUsage": {
        "type": "object",
        "properties": {
          "documentTypeId": { "type": "string" },
          "documentTypeName": { "type": "string" },
          "usageCount": { "type": "integer" },
          "lastUsed": { "type": "string", "format": "date-time" }
        }
      },
      "RecentDocumentInsight": {
        "type": "object",
        "properties": {
          "fileId": { "type": "string" },
          "name": { "type": "string" },
          "status": { "type": "string" },
          "documentTypeId": { "type": "string" },
          "completedDate": { "type": "string", "format": "date-time" },
          "confidence": { "type": "number" }
        }
      },
      "DocumentCollectionSummary": {
        "type": "object",
        "properties": {
          "documentTypeId": { "type": "string" },
          "documentTypeName": { "type": "string" },
          "category": { "type": "string" },
          "documentCount": { "type": "integer" },
          "averageConfidence": { "type": "number" },
          "latestDocuments": {
            "type": "array",
            "items": { "$ref": "#/components/schemas/CollectionDocumentSummary" }
          }
        }
      },
      "CollectionDocumentSummary": {
        "type": "object",
        "properties": {
          "fileId": { "type": "string" },
          "name": { "type": "string" },
          "status": { "type": "string" },
          "uploadDate": { "type": "string", "format": "date-time" },
          "assignedDate": { "type": "string", "format": "date-time" },
          "completedDate": { "type": "string", "format": "date-time" }
        }
      },
      "AggregationFeedItem": {
        "type": "object",
        "properties": {
          "fileId": { "type": "string" },
          "fileName": { "type": "string" },
          "status": { "type": "string" },
          "documentTypeId": { "type": "string" },
          "documentTypeName": { "type": "string" },
          "confidence": { "type": "number" },
          "summary": { "type": "string" },
          "lastUpdated": { "type": "string", "format": "date-time" },
          "highlights": {
            "type": "array",
            "items": { "type": "string" }
          }
        }
      },
      "ProcessingQueueResult": {
        "type": "object",
        "properties": {
          "items": {
            "type": "array",
            "items": { "$ref": "#/components/schemas/ProcessingQueueItem" }
          },
          "hasMore": { "type": "boolean" },
          "asOf": { "type": "string", "format": "date-time" },
          "page": { "type": "integer", "format": "int32" },
          "pageSize": { "type": "integer", "format": "int32" }
        }
      },
      "ProcessingQueueItem": {
        "type": "object",
        "properties": {
          "workId": { "type": "string", "format": "uuid" },
          "documentId": { "type": "string" },
          "fileName": { "type": "string" },
          "stage": { "type": "string" },
          "status": { "type": "string" },
          "attempt": { "type": "integer", "format": "int32" },
          "retryCount": { "type": "integer", "format": "int32" },
          "maxAttempts": { "type": "integer", "format": "int32" },
          "correlationId": { "type": "string" },
          "enqueuedAt": { "type": "string", "format": "date-time" },
          "lastDequeuedAt": { "type": "string", "format": "date-time" },
          "lastAttemptCompletedAt": { "type": "string", "format": "date-time" },
          "queueAge": { "type": "string", "format": "duration" },
          "uploadedAt": { "type": "string", "format": "date-time" },
          "lastProcessedAt": { "type": "string", "format": "date-time" },
          "assignedProfileId": { "type": "string" },
          "lastError": { "type": "string" },
          "nextAttemptAt": { "type": "string", "format": "date-time" },
          "stageTelemetry": {
            "type": "array",
            "items": { "$ref": "#/components/schemas/ProcessingStageSnapshot" }
          }
        }
      },
      "ProcessingStageSnapshot": {
        "type": "object",
        "properties": {
          "stage": { "type": "string" },
          "lastStatus": { "type": "string" },
          "lastQueuedAt": { "type": "string", "format": "date-time" },
          "lastStartedAt": { "type": "string", "format": "date-time" },
          "lastCompletedAt": { "type": "string", "format": "date-time" },
          "lastDuration": { "type": "string", "format": "duration" },
          "lastError": { "type": "string" },
          "lastInputTokens": { "type": "integer", "format": "int64" },
          "lastOutputTokens": { "type": "integer", "format": "int64" },
          "lastCorrelationId": { "type": "string" },
          "attemptCount": { "type": "integer", "format": "int32" },
          "successCount": { "type": "integer", "format": "int32" },
          "failureCount": { "type": "integer", "format": "int32" },
          "attempts": {
            "type": "array",
            "items": { "$ref": "#/components/schemas/ProcessingStageAttemptSnapshot" }
          }
        }
      },
      "ProcessingStageAttemptSnapshot": {
        "type": "object",
        "properties": {
          "attempt": { "type": "integer", "format": "int32" },
          "startedAt": { "type": "string", "format": "date-time" },
          "completedAt": { "type": "string", "format": "date-time" },
          "status": { "type": "string" },
          "duration": { "type": "string", "format": "duration" },
          "error": { "type": "string" },
          "inputTokens": { "type": "integer", "format": "int64" },
          "outputTokens": { "type": "integer", "format": "int64" }
        }
      },
      "ProcessingTimelineEntry": {
        "type": "object",
        "properties": {
          "documentId": { "type": "string" },
          "fileName": { "type": "string" },
          "events": {
            "type": "array",
            "items": { "$ref": "#/components/schemas/ProcessingTimelineEvent" }
          }
        }
      },
      "ProcessingTimelineEvent": {
        "type": "object",
        "properties": {
          "stage": { "type": "string" },
          "status": { "type": "string" },
          "detail": { "type": "string" },
          "error": { "type": "string" },
          "createdAt": { "type": "string", "format": "date-time" },
          "attempt": { "type": "integer", "format": "int32" },
          "correlationId": { "type": "string" },
          "duration": { "type": "string", "format": "duration" },
          "chunkId": { "type": "string", "format": "uuid" },
          "insightId": { "type": "string", "format": "uuid" },
          "metrics": {
            "type": "object",
            "additionalProperties": { "type": "number", "format": "double" }
          },
          "context": {
            "type": "object",
            "additionalProperties": { "type": "string" }
          },
          "inputTokens": { "type": "integer", "format": "int64" },
          "outputTokens": { "type": "integer", "format": "int64" },
          "isTerminal": { "type": "boolean" }
        }
      },
      "ProcessingRetryRequest": {
        "type": "object",
        "properties": {
          "force": { "type": "boolean" },
          "stage": { "type": "string", "nullable": true }
        }
      },
      "ModelDescriptor": {
        "type": "object",
        "properties": {
          "name": { "type": "string" },
          "provider": { "type": "string" },
          "displayName": { "type": "string" },
          "capabilities": {
            "type": "array",
            "items": { "type": "string" }
          },
          "size": { "type": "string" },
          "isVisionCapable": { "type": "boolean" },
          "isInstalled": { "type": "boolean" }
        }
      },
      "InstallModelRequest": {
        "type": "object",
        "properties": {
          "provider": { "type": "string" }
        }
      },
      "ModelInstallationStatus": {
        "type": "object",
        "properties": {
          "installationId": { "type": "string", "format": "uuid" },
          "provider": { "type": "string" },
          "modelName": { "type": "string" },
          "state": { "type": "string" },
          "progress": { "type": "integer" },
          "currentStep": { "type": "string" },
          "enqueuedAt": { "type": "string", "format": "date-time" },
          "startedAt": { "type": "string", "format": "date-time" },
          "completedAt": { "type": "string", "format": "date-time" },
          "lastUpdated": { "type": "string", "format": "date-time" },
          "errorMessage": { "type": "string" }
        }
      }
    }
  }
}
